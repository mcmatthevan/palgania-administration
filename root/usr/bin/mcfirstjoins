#!/usr/bin/python3
from subprocess import Popen, PIPE
import re,json

p = Popen("mclogs all creating empty config\\S \\S+?userdata".split(" "),stdout=PIPE)
logs = p.communicate()[0].decode().replace("\x1b[0m","").replace("\x1b[32m","").replace("\x1b[01;31m\x1b[K","").replace("\x1b[m\x1b[K","")
logs = re.sub(r"\n*--------BEGIN \S+.log---------\n--------END \S+.log---------\n*","",logs).split("-----------------BEGIN ")
dic = {}
for l in logs:
	date = re.search(r"--------END ([0-9]+-[0-9]+-[0-9]+)-[0-9]+\.log(?:---------)?",l).groups()[0]
	print(l)
	for uuid in re.search(r"userdata/(\S+?)\.yml",l).groups():
		dic[uuid] = date
open("firstjoins.json","w").write(json.dumps(dic))
